  <div class="meta" *ngIf="filteredProducts.length">
    {{ filteredProducts.length }} produse găsite
  </div>

  <div *ngIf="loading" class="state">Se încarcă…</div>
  <div *ngIf="error" class="state error">{{ error }}</div>

  <div class="product-list" *ngIf="!loading && !error">
    <div *ngFor="let product of filteredProducts" class="product-card">

      <button
        class="add-to-list-btn"
        type="button"
        (click)="auth.isLoggedIn() ? addToList(product.productId) : goToLogin()"
        [disabled]="!auth.isLoggedIn() || addingId === product.productId"
        [title]="auth.isLoggedIn() ? 'Adaugă în lista de cumpărături' : 'Autentifică-te pentru a adăuga în listă'"
      >
        <span class="icon-swap" [class.show-check]="justAddedId === product.productId">
          <span class="icon plus"><span class="glyph">➕</span></span>
          <span class="icon check"><span class="glyph">✔️</span></span>
        </span>
      </button>

      <div class="product-image">
        <img
          *ngIf="product.imageUrl; else placeholder"
          [src]="product.imageUrl"
          [alt]="product.name"
        />

        <ng-template #placeholder>
          <div class="img-placeholder">
            {{ product.name.charAt(0) | uppercase }}
          </div>
        </ng-template>
      </div>

      <div class="product-content">
        <div class="product-header">
          <div>
            <div class="product-name">{{ product.name | titlecase }}</div>
            <div class="product-subtitle">
              {{ product.brand }} • {{ product.quantity }}{{ product.unit }}
            </div>
          </div>
        </div>

        <div class="price-column">
        <div class="best-price-strip" *ngIf="product.bestOffer as bo">
          <div>
            <div class="label">Cel mai bun preț</div>

            <div class="best-price-row">
              <div class="best-price-main">
                {{ getEffectivePrice(bo) | number : '1.2-2' }} RON
              </div>

              <div class="best-price-old" *ngIf="hasDiscount(bo)">
                {{ bo.price | number : '1.2-2' }} RON
              </div>
            </div>

            <div class="best-price-per-unit" *ngIf="getDisplayPPU(product, bo) as ppu">
              {{ ppu | number:'1.2-2' }} RON / {{ getDisplayUnit(product.unit) }}
            </div>
          </div>

          <div class="best-price-side" *ngIf="getBestOffers(product) as best">
            <div class="best-store">
              <ng-container *ngIf="best.length === 1; else tieTpl">
                {{ best[0].store }}
              </ng-container>

              <ng-template #tieTpl>
                Cel mai bun preț la {{ best.length }} magazine
              </ng-template>
            </div>

            <div *ngIf="best[0].discountPercent != null" class="discount-pill">
              -{{ best[0].discountPercent | number : '1.0-0' }}%
            </div>
          </div>

        </div>

        <div class="offers-row" [ngClass]="'offers-' + product.offers.length">
          <ng-container *ngFor="let offer of product.offers">
          <div
            class="offer-card"
            [class.best]="isBestOffer(product, offer)"
          >
            <div class="offer-store">{{ offer.store }}</div>

            <div class="offer-prices">
              <div class="offer-old-price" *ngIf="hasDiscount(offer); else noDiscountTpl">
                {{ offer.price | number : '1.2-2' }} RON
              </div>

              <ng-template #noDiscountTpl>
                <div class="offer-old-price no-discount">Nu are reducere</div>
              </ng-template>

              <div class="offer-current-price">
                {{ getEffectivePrice(offer) | number : '1.2-2' }} RON
              </div>
            </div>

            <div class="offer-ppu" *ngIf="getDisplayPPU(product, offer) as ppu">
              {{ ppu | number:'1.2-2' }} RON / {{ getDisplayUnit(product.unit) }}
            </div>

            <div class="offer-badges">
              <span
                *ngIf="isBestOffer(product, offer)"
                class="pill pill-green"
              >
                Cel mai bun preț
              </span>

              <span
                *ngIf="offer.discountPercent != null"
                class="pill pill-red"
              >
                -{{ offer.discountPercent | number:'1.0-0' }}%
              </span>

            </div>
          </div>
          </ng-container>
        </div>
        </div>
      </div>
    </div>
  </div>